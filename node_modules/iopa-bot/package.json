{
  "name": "iopa-bot",
  "main": "index.js",
  "description": "API-First Bot Framework for Internet of Things (IoT), based on Internet of Protocols Alliance (IOPA) specification",
  "author": {
    "name": "iopa",
    "email": "build@iopa.io"
  },
  "license": "Apache-2.0",
  "maintainers": [
    {
      "name": "iopa",
      "email": "build@iopa.io"
    }
  ],
  "version": "1.4.1",
  "repository": {
    "type": "git",
    "url": "git+https://github.com/iopa-io/iopa-bot.git"
  },
  "dependencies": {
    "iopa": "^1.4.0",
    "alexa-utterances": "^0.2.1"
  },
  "keywords": [
    "iopa",
    "limerun",
    "serverless",
    "lambda",
    "azure function",
    "google cloud function",
    "node",
    "bot",
    "conversational agent"
  ],
  "engines": {
    "node": ">= 4.0"
  },
  "scripts": {
    "test": "mocha --reporter spec test",
    "quick": "git add . -A && git commit -m 'dev test' && npm version patch && npm publish",
    "typings": "tsd reinstall --overwrite --clean --config tools/tsd.json && tsd link"
  },
  "devDependencies": {
    "iopa-bot-console": "^1.4.1"
  },
  "devDependencies_unused": {
    "mocha": "^2.3.2",
    "mocha-junit-reporter": "^1.6.1",
    "should": "^7.1.0"
  },
  "readmeFilename": "README.md",
  "homepage": "http://iopa.io",
  "readme": "# [![IOPA](http://iopa.io/iopa.png)](http://iopa.io)<br> iopa-bot\n\n[![NPM](https://img.shields.io/badge/iopa-certified-99cc33.svg?style=flat-square)](http://iopa.io/)\n[![NPM](https://img.shields.io/badge/iopa-bot%20framework-F67482.svg?style=flat-square)](http://iopa.io/)\n\n[![NPM](https://nodei.co/npm/iopa-bot.png?downloads=true)](https://nodei.co/npm/iopa-bot/)\n\n## About\n\nThis repository contains the IOPA Bot Framework for writing and running Conversational Agents.\n\nUnlike most IOPA example implementations, this repository is not sufficient to develop a working app.  It does \nnot yet provide the connectors but these will be published over time.\n\n## Background\n\nConversational agents (or bots) can run in many environments, including Amazon Alexa, Facebook Messenger, WhatsApp, WeChat, Slack, Skype, etc.\n\nBack in 2015, the number of global users of the largest four of these environments surpassed the largest four social networks for the first time.\n\n## Limitations of Existing Solutions\n\nWriting a bot generally requires platform specific code to receive input from human participants and to reply with cards, voice, and text message.  Yet\nthe basic architecture of most bots is similar, and so we need a level of astraction to harmonize the platform differences, enable common code for the most \ncommonly used functions, and at the same time take advantage of pltaform-specific features.\n\nSome bot frameworks such as the Microsoft Bot Framework already do a lot of this abstraction but suffer from a few limitations:\n1. Some use a properietary server component that handle all the authentication and authorization, but therefore are not able to use platform-specific  \nfeatures (e.g., Slack connector in Microsoft bot framework handles free text but not Slack commands), and make using custom authentication in other parts\nof the app challenging (e.g., associating users across multiple third party networks). \n2. Others such as alexa-app, do not provide a full-featured way of handling dialogs of multiple exchanges\n3. Defining the meta data for natural language processing is sometimes handled by the service provider (e.g., Amazon Alexa, IBM Watson) and mostly not.\n4. Chat bots are ripe for serverless functions on Amazon Lambda, Azure Functions, etc., but not all frameworks make this abstraction easy.\n\n## The `iopa-bot` solution\n\n This framework provides a lightweight abstraction layer to translate the request and response into a format\nthat can be reused regardless of the host environment, and can be used locally for console testing just as easily as remotely.  It sits on top\nof iopa-serverless so can be used in any serverless environment, locally on an express server, or on custom infrastructure.\n\n`iopa-bot` provides an opinionated way to define converational schemas, with industry-standard features such as dialogs, intents, slots, and utterances and exports this\nmetadata for direct loading into the service provider (e.g., Amazon Alexa).\n\nIt is one of the few bot frameworks today that can serve both an Alexa bot and a Text-based chat bot such as Slack, with the same application codeset.\n\n\n## Usage\n``` bash\nnpm install iopa-bot\n```\n\n## Example App\n``` js\n\nconst iopaServerless=require('./iopa-serverless'),\n      iopa = require('iopa').App,\n      connector_slack = require('./connectors/slack'),\n      iopaBotFramework = require('./iopa-bot'),\n      bot_helloworld = require('./bot-skills/helloworld');\n\nmodule.exports = iopaServerless.azure(\n  function (context) {\n\n    var app = new iopa();\n    app.use(connector_slack);\n    app.use(iopaBotFramework);\n    app.use(bot_helloworld);\n    app.build();\n \n    return app.invoke(context);\n  }\n);\n```\n\n## Example Skill (bot_helloworld.js)\n``` js\nconst iopa = require('iopa'),\n    constants = iopa.constants,\n    IOPA = constants.IOPA,\n    SERVER = constants.SERVER,\n    BOT = require('iopa-bot').constants.BOT;\n\nmodule.exports = function SkillsContainer(app) {\n    app.intent('hello',\n        {\n            \"utterances\": [\n                \"hi\",\n                \"hello\",\n                \"hey\"]\n        }, function (context, next) {\n            context.response.say(\"Hi there.\");\n            return context.response.send();\n        });\n}\n```\n\n\n## Example Dialog Skill (bot_helloworld.js)\n``` js\nconst iopa = require('iopa'),\n    constants = iopa.constants,\n    IOPA = constants.IOPA,\n    SERVER = constants.SERVER,\n    BOT = require('iopa-bot').constants.BOT;\n\nmodule.exports = function SkillsContainer(app) {\n app.dialog('QuestionDialog', function displayquestion(context, next) {\n    var card = {\n      type: \"Standard\",\n      text: \"Are you happy?\",\n      title: \"A sample question\",\n      image: {\n        smallImageUrl: \"https://crossorigin.me/https://github.io/small.png\",\n        largeImageUrl: \"https://crossorigin.me/https://github.io/large.png\",\n      },\n    \"attachments\": [\n      {     actions: [\n        {\n          \"name\": \"yes\",\n          \"text\": \"Yes\",\n          \"type\": \"button\",\n          \"value\": \"YesIntent\"\n        },\n        {\n          \"name\": \"No\",\n          \"text\": \"No\",\n          \"type\": \"button\",\n          \"value\": \"NoIntent\"\n        }\n      ]\n    }]\n    }\n    return context.response.card(card).send();\n  },\n    ['YesIntent', 'NoIntent'],\n    function (context, next) {\n\n     var value;\n      switch (context[BOT.Intent]) {\n        case 'NoIntent':\n          value = 0;\n          break;\n       case 'YesIntent':\n          value = 1;\n          break;\n       }\n      context.response.status(200).say(\"value = \" + value).send();\n      return context[SERVER.Capabilities][BOT.CAPABILITIES.Dialog].beginDialog('WrapupDialog', context, next);\n    }\n  );\n}\n```\n\n## Reference\n\n### Skills\n\nEach conversational agent is made up of one or more skills.  A skill is a set of machine intelligence functions that generally relate to a common\napplication domain.   Some skills (e.g., weather) may be shared across multiple bots.\n\n### Sessions\n\nEach exchange between a human and a bot (or two bots) is managed in a virtual session.  This is not necessarily and in fact unlikely to be a transport\nsession, but does allow for session context data to be persisted across the duration of the session.\n\nA session may be handled by (serverless) cloud functions running across multiple regions or infrastructure, so the persistence (provided by the connector or \nsource service provider) can be thought of as a temporary global data store unique to this session.\n\n### Intents\nAn intent is the meaning of what the remote participant is trying to convey.  There are usually multiple ways (utterances) to say \na given intent.\n\nDefining an intent is just like using a router in any web framework:\n\n``` js\napp.intent(INTENT_NAME, function(context, next){ .... });\n```\n\nThe combined schema for all intents can be summarized (for upload to Alexa for example) by using\n``` js\n context.log(app.properties[\"server.Capabilities\"][\"urn:io.iopa.bot:skills\"].skill('default').schema())\n```\n\n### Utterances\nExample utterances that the user might say to mean a given intent\n\nDefine utterances as part of the intent function:\n\n``` js\napp.intent(\"YesIntent\" \n {\n    \"utterances\": [\"yes\", \"sure\", \"yup\"]\n  },\n  function(context, next){ .... });\n```\n\nAll utterances can be summarized (for upload to Alexa for example) by using\n``` js\n context.log(app.properties[\"server.Capabilities\"][\"urn:io.iopa.bot:skills\"].skill('default').utterances())\n```\n\n### Slots \nA slot is a variable of a given type that is provided by the user for a given utterance \n\nDefine slots as part of the intent function:\n\n``` js\napp.intent('SumAnswerIntent', \n  {\n      \"slots\": [\n        {\n          \"name\": \"Answer\",\n          \"type\": \"NUMBER\"\n        }],\n      \"utterances\": [\"The sum is {Answer}\"]\n    });\n  function(context, next){ .... });\n```\n\n### Request\nAn event indicating that the user has invoked the conversational agent, either by launching it or \"saying\" something\n\nAccess variables on the request as direct keys of the iopa context record\n``` js\nvar intent = context[\"bot:Intent\"];\n```\n\n### Response\nA (reactive) response to a given request that the bot issues after processing a request. \n\nAccess functions on the response as direct keys of the iopa context.response record.  Most functions return the response \nrecord and so functions can be chained.\n\n``` js\ncontext.response.status(200).say(\"Hello World\").send();\n```\n\n### Pro-active response\nAn outbound message that is issued in a given session but not immediately upon receiving a request; for example a bot may \nrespond straight away, but later send another message in follow up.\n\n### dialogs\nA dialog is the logical expected grouping of requests and responses.  Often these are waterfall in nature (request -> response,  next request -> response, last request -> response);\nA dialog may return a response to the remote participant, do nothing, or launch another dialog (immediately).  \n\n### Context record\n\n#### Request Data\n\nRequired | IOPA Key Name |  Value Description\n:------: | ------------- |  -------------------------------------\nYes | \"bot:Source\" | The urn of the conversational agent service provider e.g., \"urn:io.iopa.bot:slack\", \"urn:io.iopa.bot:alexa\"\nYes | \"bot:Intent\" | The intent of the message (usually derived in middleware by parsing audio or free form text, but may be provided by service provider such as Alexa)\nNo | \"bot:Text\" | The original source message as entered by the user\nNo | \"bot:MessageId\" | The unique identifier for this particular context record\nYes | bot:Timestamp\" | The timestamp (in milliseconds since epoch) of the message\nYes | \"bot:Session\" | A read/write property dictionary of session data that is persisted for the entire session (even across host execution servers/regions)\nNo | \"bot:Slots\" | The variables values in the input message that correspond to the variable keys for this intent/utterance\nNo | \"bot:Variables\" | The variables keys that correspond to the variable values provided in the input message \n\n#### Request bot.Address Sub fields\nRequired | IOPA Key Name |  Value Description\n:------: | ------------- |  -------------------------------------\nYes | \"bot:User\" | The unique id of the user (within the domain of this source)\nYes | \"bot:Bot\" | The unique id of the bot (within the domain of this sourcee)\nNo | \"bot.Conversation\" | The conversation identifier\nYes | \"bot.Session\" | The unique identifier for this session (not necessarily unique across time, but unique for a given exchange at a given time)\nNo | \"bot:OrgUnit\" | The team or organizational identifier (e.g., Slack team)\n\n### Session bot.Session Sub fields \nRequired | IOPA Key Name |  Value Description\n:------: | ------------- |  -------------------------------------\nYes |   \"bot:Skill\" | The name of the skill that is currently being invoked for this session (used internally by dialog manager, but public)\nYes | \"bot:NewSession\" | The associated request is the first one for this session\nNo | \"bot:CurrentDialog\" | The name and step of the current dialog being executed (used internally by dialog manager)\n\n### Response functions\nRequired | IOPA Key Name |  Value Description\n:------: | ------------- |  -------------------------------------\nYes | say | `void func(text)` Reply to the user with the given text; calling successively before Send will append multiple lines\nYes | card | `void func(object)` Reply to the user with the given card which can include text, images, buttons etc.\nYes | show | `void func(object)` Show on the secondary modality (or display) the given card which can include text, images, buttons etc.\nYes | \"bot:Reprompt\" | `void func(text)` Store the text with which to reprompt the user in case of error/timeout\nYes | \"bot:ShouldEndSession\" | `void func(boolean)` Indicate that on completion of this exchange the session should be closed and disposed\nYes | \"bot:Send\" | `void func()` Display/send the text and/or cards queued up by the above functions\nYes | \"bot:Fail\" | `void func(err)` Display/send the error message as the body of the response instead of the text/card already queued up\nYes | status | `void func(int)` Set the status code (e.g., 200 for OK, 500 for server error)\n\n## Roadmap\n\nNote: connectors will be released in the future for each of the major bot service providers.  Contributions are welcome.\n\n## Inspiration / Third Party\n\nThe conversational schema is based on most common bot frameworks but inspired by the Amazon Alexa schema and alexa-app Copyright (c) 2016 Matt Kruse licensed under MIT \n\nThe dialog approach is based on several common bot frameworks but influenced by the open source Microsoft Bot Framework\n\nThe parsing and matching functions are based on chatskills Copyright (c) 2016 Kory Becker licensed under MIT \nand alexa-app Copyright (c) 2016 Matt Kruse licensed under MIT \n\n## License\n\nApache-2.0\n\n## API Reference Specification\n\n[![IOPA](http://iopa.io/iopa.png)](http://iopa.io)\n ",
  "gitHead": "b4a235f4b25db6b69f17177b0a78e0621c28e3a9",
  "bugs": {
    "url": "https://github.com/iopa-io/iopa-bot/issues"
  },
  "_id": "iopa-bot@1.4.1",
  "_shasum": "ac0f5a32a25666e57cf137a1271f25c95857cfaf",
  "_from": "iopa-bot@>=1.4.0 <2.0.0"
}
